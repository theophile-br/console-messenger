(()=>{"use strict";var e={247:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleAudioSystem=void 0,t.ConsoleAudioSystem=class{bell(){process.stdout.write("")}play(){throw new Error("Method not implemented.")}}},315:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BroadcastCommunication=void 0;const i=r(s(891)),o=s(178),n=s(456),a=s(781),c="HELLO";t.BroadcastCommunication=class{constructor(e,t){this.crypto=e,this.config=t,this.server=i.default.createSocket("udp4"),this.port=41234,this.carnet=[],this.event=new a.EventEmitter,this.server.on("message",((e,t)=>{if(t.address===o.NetUtils.getMyLocalIPv4()||"127.0.0.1"===t.address)return;this.carnet.includes(t.address)||this.carnet.push(t.address);const s=this.crypto.decrypt(""+e),r=JSON.parse(s);r.code!==c?this.event.emit(n.CommunicationEvent.MESSAGE,r.content):this.server.send(this.crypto.encrypt(JSON.stringify({code:"MSG",content:`${this.config.pseudo} is here !`})),this.port,t.address)})),this.server.on("listening",(()=>{this.server.setBroadcast(!0),this.event.emit(n.CommunicationEvent.LISTENING)})),this.server.on("close",(()=>{this.server.close(),this.event.emit(n.CommunicationEvent.CLOSE)})),this.server.on("error",(e=>{this.server.close(),this.event.emit(n.CommunicationEvent.ERROR,e)})),this.server.bind(this.port)}sendMessage(e){const t={code:"MSG",content:`${this.config.pseudo} : ${e}`},s=JSON.stringify(t),r=this.crypto.encrypt(s);for(const e of this.carnet)e!==o.NetUtils.getMyLocalIPv4()&&this.server.send(r,this.port,e,(e=>{e&&console.log(e)}))}netScan(){const e=this.crypto.encrypt(JSON.stringify({code:c,content:""}));this.server.send(e,this.port,o.NetUtils.getBroadcastIPv4())}}},456:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CommunicationEvent=void 0,(s=t.CommunicationEvent||(t.CommunicationEvent={})).ERROR="0",s.MESSAGE="1",s.LISTENING="2",s.CLOSE="3"},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequireArgParamsError=void 0;class s extends Error{constructor(e){super(`arg ${e} is required`)}}t.RequireArgParamsError=s},884:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ArgParseConfig=void 0;const r=s(874);t.ArgParseConfig=class{load(){let e=process.argv.indexOf("-p");if(this.pseudo=-1===e?"":process.argv[e+1].toUpperCase(),e=process.argv.indexOf("-r"),this.room=-1===e?"":process.argv[e+1].toUpperCase(),e=process.argv.indexOf("-s"),this.silent=-1===e,!this.pseudo)throw new r.RequireArgParamsError("-p")}}},73:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleMessenger=void 0;const r=s(178),i=s(456),o=s(602);t.ConsoleMessenger=class{constructor(e,t,s,r,i){this.config=e,this.communication=t,this.display=s,this.userInput=r,this.audioSystem=i}async start(){try{this.config.load()}catch(e){this.display.print(e.message),process.exit()}this.userInput.event.on(o.UserInputEvent.ENTER_KEYDOWN,(e=>this.onEnter(e))),this.communication.event.on(i.CommunicationEvent.MESSAGE,(e=>{this.display.receiveMessage(e)})),this.communication.event.on(i.CommunicationEvent.CLOSE,(()=>{this.display.print("program stop"),process.exit()})),this.communication.event.on(i.CommunicationEvent.CLOSE,(e=>{this.display.print(`server error:\n${e.stack}`),process.exit()})),this.communication.event.on(i.CommunicationEvent.LISTENING,(()=>{console.clear(),""!==this.config.room&&this.display.print(`Enter un room ${this.config.room}`),this.display.print(`My Local adresse IP is ${r.NetUtils.getMyLocalIPv4()}/${r.NetUtils.getMyLocalIPv4Mask()}`),this.display.print(`My BroadcastAddr is ${r.NetUtils.getBroadcastIPv4()}`),this.display.print("scaning network please wait.."),this.communication.netScan()}))}onEnter(e){this.userInput.clearLine(),"/"===e[0]?this.runCommand(e):(this.config.silent&&this.audioSystem.bell(),this.communication.sendMessage(e),this.display.print(`YOU : ${e}`))}runCommand(e){if("/scan"===e)return this.display.print("scaning network please wait.."),void this.communication.netScan()}}},245:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SecretWordExceedThe32CharLimitError=void 0;class s extends Error{constructor(){super("Secret word exceed the 32 char limit")}}t.SecretWordExceedThe32CharLimitError=s},555:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CipherCrypto=void 0;const i=r(s(113)),o=s(245);t.CipherCrypto=class{constructor(){this.algorithm="aes-256-ctr",this.SECRET_KEY="vOVH6sAzeNWjRRIqCc7rgsd01LwHzfR3",this.iv=i.default.randomBytes(16)}encrypt(e){const t=i.default.createCipheriv(this.algorithm,this.SECRET_KEY,this.iv),s=Buffer.concat([t.update(e),t.final()]);return JSON.stringify({iv:this.iv.toString("hex"),content:s.toString("hex")})}decrypt(e){const t=JSON.parse(e),s=i.default.createDecipheriv(this.algorithm,this.SECRET_KEY,Buffer.from(t.iv,"hex"));return Buffer.concat([s.update(Buffer.from(t.content,"hex")),s.final()]).toString()}setupSecret(e){if(e.length>32)throw new o.SecretWordExceedThe32CharLimitError;return this.SECRET_KEY=e+this.SECRET_KEY.slice(e.length,this.SECRET_KEY.length),this.SECRET_KEY}}},210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleDisplay=void 0,t.ConsoleDisplay=class{constructor(e){this.userInput=e}receiveMessage(e){return this.userInput.cut(),this.print(e),this.userInput.paste(),e}print(e){return console.log(e),e}}},551:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleUserInput=void 0;const i=r(s(521)),o=s(282),n=s(781),a=s(602);t.ConsoleUserInput=class{constructor(){this.cursorPosition=0,this.memory="",this.event=new n.EventEmitter,this.rl=i.default.createInterface(o.stdin,o.stdout),this.rl.on("line",(e=>this.event.emit(a.UserInputEvent.ENTER_KEYDOWN,e)))}cut(){this.memory=this.rl.line,this.rl.line="",i.default.clearLine(process.stdin,0),i.default.cursorTo(process.stdin,0),this.rl.pause()}paste(){this.rl.write(this.memory),this.rl.resume()}clearLine(){i.default.moveCursor(process.stdin,0,-1),i.default.clearLine(process.stdin,0)}}},602:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserInputEvent=void 0,(t.UserInputEvent||(t.UserInputEvent={})).ENTER_KEYDOWN="0"},178:function(e,t,s){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NetUtils=void 0;const i=r(s(37));class o{static getIPv4Info(){var e=i.default.networkInterfaces();return Object.entries(e).map((e=>e[1])).flat().filter((e=>"IPv4"===e.family)).find((e=>"127.0.0.1"!==e.address&&"localhost"!==e.address))}static getMyLocalIPv4CIDR(){const e=o.getIPv4Info();if(!e)throw new Error;return e.cidr}static getMyLocalIPv4(){var e,t;return null!==(t=null===(e=o.getMyLocalIPv4CIDR())||void 0===e?void 0:e.split("/")[0])&&void 0!==t?t:""}static getMyLocalIPv4Mask(){var e,t;return null!==(t=null===(e=o.getMyLocalIPv4CIDR())||void 0===e?void 0:e.split("/")[1])&&void 0!==t?t:""}static getBroadcastIPv4(){const e=o.getIPv4Info();if(!e)throw new Error;var t=e.address.split("."),s=e.netmask.split(".");return t.map(((e,t)=>255&~s[t]|e)).join(".")}}t.NetUtils=o},113:e=>{e.exports=require("crypto")},891:e=>{e.exports=require("dgram")},37:e=>{e.exports=require("os")},282:e=>{e.exports=require("process")},521:e=>{e.exports=require("readline")},781:e=>{e.exports=require("stream")}},t={};function s(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,s),o.exports}(()=>{const e=s(884),t=s(315),r=s(73),i=s(555),o=s(210),n=s(551),a=s(247),c=new e.ArgParseConfig,u=new i.CipherCrypto,l=new t.BroadcastCommunication(u,c),d=new n.ConsoleUserInput,h=new a.ConsoleAudioSystem,p=new o.ConsoleDisplay(d);new r.ConsoleMessenger(c,l,p,d,h).start()})()})();